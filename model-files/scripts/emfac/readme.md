
## Directory Structure

This is the directory structure on M: within the OUTPUT dir.
For example, see `M:\Application\Model One\RTP2021\Blueprint\2035_TM152_FBP_Plus_24\OUTPUT\emfac`

```
emfac/
  emfac_prep/
    CreateSpeedBinsBetweenZones_sums.csv  # created by BetweenZonesVMT.py
    CreateSpeedBinsWithinZones_sums.csv   # created by CreateSpeedBinsWithinZones.job
  EIR/
    E2017/
    E2021/
  SB375/
    E2014/
      E2014_2035_TM160_IPA_17_annual.xlsx   # Custom activity file generated by emfac_prep.py
      E2014_2035_TM160_IPA_17_annual.log    # Log file generated by emfac_prep.py
    E2021/
      E2021_2035_TM160_IPA_17_annual.xlsx   # Custom activity file generated by emfac_prep.py
      E2021_2035_TM160_IPA_17_annual.xlsx   # Log file generated by emfac_prep.py

```

[RunPrepareEmfac.bat](../../RunPrepareEmfac.bat)

This batch job processes three types of activity data (by county) for input into EMFAC to run in Burden mode 
and calculating regional on-road emission inventories.  The three types of activity data (all by county) that will 
be inputted are: (1) vehicle speed distribution files (for passenger vehicle types only); (2) vmt files by time of 
day and fuel type; (3) vehicle population files by vehicle type and fuel type.

There are five scripts/steps that produce the activity data input into EMFAC. 

Step (1) [BetweenZonesVMT.py](BetweenZonesVMT.py)

This script extracts link level VMT and speeds for the 13 ARB speed cohorts.
This generic script forecast year run applies for all 5 timeperiods.      

Step (2) [CreateSpeedBinsWithinZones.job](CreateSpeedBinsWithinZones.job)

This script - a) extracts intrazonal level VMT and speeds; and b) extracts total daily trips for the 13 ARB speed cohorts. This generic script forecast year run also applies for all 5 timeperiods.      

Step (3) [emfac_pre.py](emfac_prep.py)

This script reads the files generated by the previous two scripts, and 
* calculates the hourly VMT fractions by speed bin and subarea;
* rescales VMT by vehicle technology to the Travel Model VMT total (using the default vehicle technology proportions in the default EMFAC template);
* outputs an excel file that is in the format of an EMFAC "custom activity template".

The custom activity template serves as an input to EMFAC.
